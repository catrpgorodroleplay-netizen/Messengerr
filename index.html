<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web</title>
    <link rel="stylesheet" href="styles/auth.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/chat.css">
    <link rel="stylesheet" href="styles/settings.css">
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –≤—Ö–æ–¥–∞ -->
    <div id="start-screen" class="screen active">
        <div class="auth-container">
            <div class="auth-logo">‚úàÔ∏è</div>
            <h1 class="auth-title">Telegram Web</h1>
            <p class="auth-subtitle">–ë—ã—Å—Ç—Ä—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</p>
            
            <div class="auth-buttons">
                <button class="btn-primary" onclick="showLogin()">–í–æ–π—Ç–∏ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</button>
                <button class="btn-secondary" onclick="showRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <div id="login-screen" class="screen">
        <div class="auth-container">
            <h1 class="auth-title">–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h1>
            
            <div class="auth-form">
                <input type="text" id="login-username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" class="auth-input">
                <input type="password" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å" class="auth-input">
                <button class="btn-primary" onclick="login()">–í–æ–π—Ç–∏</button>
                <button class="btn-secondary" onclick="showStartScreen()">–ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="register-screen" class="screen">
        <div class="auth-container">
            <h1 class="auth-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
            
            <div class="auth-form">
                <input type="text" id="reg-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" class="auth-input">
                <input type="password" id="reg-password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" class="auth-input">
                <input type="text" id="reg-firstname" placeholder="–í–∞—à–µ –∏–º—è" class="auth-input">
                <input type="text" id="reg-lastname" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è" class="auth-input">
                <button class="btn-primary" onclick="register()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                <button class="btn-secondary" onclick="showStartScreen()">–ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —á–∞—Ç–æ–≤ -->
    <div id="main-screen" class="screen">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="user-info" onclick="showSettings()">
                    <div class="avatar" id="user-avatar">üë§</div>
                    <div>
                        <div id="current-user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                        <div class="online-status">online</div>
                    </div>
                </div>
                <button class="btn-icon" onclick="showNewChat()">‚úèÔ∏è</button>
            </div>

            <div class="search-container">
                <input type="text" id="search-contacts" placeholder="–ü–æ–∏—Å–∫" class="search-input">
            </div>

            <div class="chats-list" id="chats-list">
                <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
        <div class="chat-area">
            <div class="chat-header" id="chat-header">
                <div class="chat-partner-info">
                    <div class="avatar">üë•</div>
                    <div>
                        <div class="chat-name" id="current-chat-name">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
                        <div class="online-status" id="online-status">–æ–Ω–ª–∞–π–Ω</div>
                    </div>

</div>
                <div class="chat-actions">
                    <button class="btn-icon" onclick="searchMessages()">üîç</button>
                    <button class="btn-icon" onclick="showChatSettings()">‚ãÆ</button>
                </div>
            </div>

            <div class="messages-container" id="messages-container">
                <div class="empty-chat">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</p>
                </div>
            </div>

            <div class="message-input-container">
                <input type="text" id="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="handleKeyPress(event)">
                <button class="btn-send" onclick="sendMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π -->
    <script src="modules/auth.js"></script>
    <script src="modules/messages.js"></script>
    <script src="modules/contacts.js"></script>
    <script src="modules/settings.js"></script>
    <script src="modules/utils.js"></script>
    
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç -->
    <script>
        // –ü—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–æ–≤
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showStartScreen() { showScreen('start-screen'); }
        function showLogin() { showScreen('login-screen'); }
        function showRegister() { showScreen('register-screen'); }
        function showMainScreen() { showScreen('main-screen'); }

        // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        function register() {
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const firstName = document.getElementById('reg-firstname').value;
            const lastName = document.getElementById('reg-lastname').value;

            if (!username  !password  !firstName) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = {
                id: Date.now().toString(),
                username: username,
                firstName: firstName,
                lastName: lastName,
                online: true
            };

            localStorage.setItem('currentUser', JSON.stringify(user));
            localStorage.setItem('userPassword', password);

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
            if (window.contactManager) {
                contactManager.loadSampleContacts();
            }

            showMainScreen();
            updateUserInfo(user);
        }

        // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤—Ö–æ–¥
        function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const savedUser = localStorage.getItem('currentUser');
            const savedPassword = localStorage.getItem('userPassword');

            if (savedUser && savedPassword === password) {
                const user = JSON.parse(savedUser);
                
                if (window.contactManager) {
                    contactManager.loadSampleContacts();
                }
                if (window.messageManager) {
                    messageManager.connectSocket();
                }

                showMainScreen();
                updateUserInfo(user);
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
            }
        }

function updateUserInfo(user) {
            document.getElementById('current-user-name').textContent = 
                ${user.firstName} ${user.lastName};
            document.getElementById('user-avatar').textContent = 
                user.firstName[0] + (user.lastName ? user.lastName[0] : '');
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            
            if (text && window.messageManager) {
                // –í—Ä–µ–º–µ–Ω–Ω–æ - –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                const messagesContainer = document.getElementById('messages-container');
                messagesContainer.innerHTML = 
                    <div class="message message-outgoing">
                        <div class="message-text">${text}</div>
                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                    </div>
                ;
                input.value = '';
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                if (window.contactManager) {
                    contactManager.loadSampleContacts();
                }
                showMainScreen();
                updateUserInfo(user);
            }
        });
    </script>
</body>
    </html>
